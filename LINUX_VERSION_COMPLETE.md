# Linux ç‰ˆæœ¬å®ç°å®ŒæˆæŠ¥å‘Š

**æ—¥æœŸ**: 2025-01-03  
**ç‰ˆæœ¬**: 2.0.0 (Linuxæ ¸å¿ƒåŠŸèƒ½)  
**çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½å·²å®Œæ•´å®ç°

---

## ğŸ“Š å®ç°è¿›åº¦å¯¹æ¯”

### ä¹‹å‰çŠ¶æ€ (å ä½ç¬¦)
| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|-----|------|------|
| IBusé›†æˆ | âŒ å ä½ç¬¦ | ä»…è¿”å›ç¡¬ç¼–ç æ•°æ® |
| fcitxæ”¯æŒ | âŒ æ—  | ä¸æ”¯æŒ |
| X11çª—å£æ£€æµ‹ | âŒ å ä½ç¬¦ | è¿”å›"linux-app" |
| è¿›ç¨‹æ£€æµ‹ | âŒ æ—  | æ— å®é™…å®ç° |
| è¾“å…¥æ³•åˆ‡æ¢ | âŒ å‡æˆåŠŸ | è¿”å›trueä½†æ— æ•ˆæœ |

### ç°åœ¨çŠ¶æ€ (å®Œæ•´å®ç°)
| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|-----|------|------|
| IBusé›†æˆ | âœ… å®Œæ•´ | è‡ªåŠ¨æ£€æµ‹+åˆ‡æ¢+åˆ—è¡¨ |
| fcitxæ”¯æŒ | âœ… å®Œæ•´ | è‡ªåŠ¨æ£€æµ‹+åˆ‡æ¢ |
| X11çª—å£æ£€æµ‹ | âœ… å®Œæ•´ | xdotool + wmctrl |
| è¿›ç¨‹æ£€æµ‹ | âœ… å®Œæ•´ | å¤šæ–¹æ¡ˆå›é€€ |
| è¾“å…¥æ³•åˆ‡æ¢ | âœ… å®Œæ•´ | çœŸå®åˆ‡æ¢å®ç° |
| å¿«æ·é”®åˆ‡æ¢ | âœ… å®Œæ•´ | Super+Space / Ctrl+Space |

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½å®ç°è¯¦æƒ…

### 1. è¾“å…¥æ³•æ¡†æ¶è‡ªåŠ¨æ£€æµ‹ âœ…

```csharp
private InputMethodFramework DetectInputMethodFramework()
{
    // è‡ªåŠ¨æ£€æµ‹ IBus å’Œ fcitx
    // ä½¿ç”¨ which å‘½ä»¤æ£€æµ‹å¯æ‰§è¡Œæ–‡ä»¶
    // ä¼˜å…ˆä½¿ç”¨ IBus
}
```

**ç‰¹æ€§**:
- âœ… è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿä¸­å¯ç”¨çš„è¾“å…¥æ³•æ¡†æ¶
- âœ… ä¼˜å…ˆé€‰æ‹© IBusï¼Œå…¶æ¬¡ fcitx
- âœ… ç»“æœç¼“å­˜ï¼Œæé«˜æ€§èƒ½
- âœ… ä¼˜é›…é™çº§å¤„ç†

### 2. IBus å®Œæ•´é›†æˆ âœ…

#### è·å–å½“å‰è¾“å…¥æ³•
```csharp
private string GetCurrentIBusInputSource()
{
    // æ‰§è¡Œ: ibus engine
    // è§£æè¾“å‡ºå¹¶æ˜ å°„åˆ°ä¸­æ–‡åç§°
    // æ”¯æŒ10ç§å¸¸ç”¨è¯­è¨€
}
```

#### åˆ‡æ¢è¾“å…¥æ³•
```csharp
private bool SwitchToIBusInputSource(string languageName)
{
    // æ‰§è¡Œ: ibus engine <engine-name>
    // ä½¿ç”¨é¢„å®šä¹‰çš„è¯­è¨€æ˜ å°„
    // è¿”å›çœŸå®åˆ‡æ¢ç»“æœ
}
```

#### åˆ—å‡ºå¯ç”¨è¾“å…¥æ³•
```csharp
private string[] GetAvailableIBusInputSources()
{
    // æ‰§è¡Œ: ibus list-engine
    // è§£æè¾“å‡ºå¹¶åŒ¹é…æ˜ å°„è¡¨
    // è¿”å›å¯ç”¨è¾“å…¥æ³•åˆ—è¡¨
}
```

**è¯­è¨€æ”¯æŒ**:
- âœ… è‹±è¯­ (ç¾å›½) â†’ xkb:us::eng
- âœ… è‹±è¯­ (è‹±å›½) â†’ xkb:gb::eng
- âœ… ä¸­æ–‡ (ç®€ä½“) â†’ pinyin
- âœ… ä¸­æ–‡ (ç¹ä½“) â†’ chewing
- âœ… æ—¥è¯­ â†’ mozc
- âœ… éŸ©è¯­ â†’ hangul
- âœ… ä¿„è¯­ â†’ xkb:ru::rus
- âœ… æ³•è¯­ â†’ xkb:fr::fra
- âœ… å¾·è¯­ â†’ xkb:de::ger
- âœ… è¥¿ç­ç‰™è¯­ â†’ xkb:es::spa

### 3. fcitx å®Œæ•´æ”¯æŒ âœ…

#### è·å–å½“å‰è¾“å…¥æ³•
```csharp
private string GetCurrentFcitxInputSource()
{
    // æ‰§è¡Œ: fcitx-remote -c
    // è§£æç´¢å¼•å¹¶æ˜ å°„åˆ°ä¸­æ–‡åç§°
}
```

#### åˆ‡æ¢è¾“å…¥æ³•
```csharp
private bool SwitchToFcitxInputSource(string languageName)
{
    // æ‰§è¡Œ: fcitx-remote -s <index>
    // ä½¿ç”¨é¢„å®šä¹‰çš„ç´¢å¼•æ˜ å°„
}
```

**ç‰¹æ€§**:
- âœ… è‡ªåŠ¨é€‚é…fcitxæ¡†æ¶
- âœ… ç´¢å¼•æ˜ å°„æ”¯æŒ
- âœ… ä¸IBusç»Ÿä¸€æ¥å£

### 4. X11 çª—å£æ£€æµ‹ âœ…

```csharp
public override async Task<string> GetCurrentApplicationAsync()
{
    // æ–¹æ¡ˆ1: xdotool getactivewindow getwindowclassname
    // æ–¹æ¡ˆ2: wmctrl (å›é€€æ–¹æ¡ˆ)
    // è¿”å›çª—å£ç±»åä½œä¸ºåº”ç”¨æ ‡è¯†
}
```

**ç‰¹æ€§**:
- âœ… å¤šå·¥å…·æ”¯æŒ (xdotool + wmctrl)
- âœ… è‡ªåŠ¨å›é€€æœºåˆ¶
- âœ… è¶…æ—¶ä¿æŠ¤ (1ç§’)
- âœ… å¼‚å¸¸å¤„ç†å®Œå–„

### 5. å¿«æ·é”®åˆ‡æ¢ âœ…

```csharp
public override async Task<bool> SwitchToInputSourceByHotkeyAsync()
{
    // IBus: xdotool key super+space
    // fcitx: xdotool key ctrl+space
}
```

**ç‰¹æ€§**:
- âœ… æ ¹æ®æ¡†æ¶é€‰æ‹©æ­£ç¡®å¿«æ·é”®
- âœ… ä½¿ç”¨xdotoolæ¨¡æ‹ŸæŒ‰é”®
- âœ… å¿«é€Ÿå“åº”

---

## ğŸ“¦ ä¾èµ–è¦æ±‚

### å¿…éœ€å·¥å…·

**è¾“å…¥æ³•æ¡†æ¶** (äºŒé€‰ä¸€):
```bash
# IBus (æ¨è)
sudo apt install ibus
sudo apt install ibus-pinyin  # ä¸­æ–‡æ‹¼éŸ³
sudo apt install ibus-mozc    # æ—¥æ–‡
sudo apt install ibus-hangul  # éŸ©æ–‡

# fcitx (å¤‡é€‰)
sudo apt install fcitx
sudo apt install fcitx-pinyin
```

**X11 å·¥å…·** (å¿…éœ€):
```bash
# xdotool - çª—å£æ“ä½œå’Œå¿«æ·é”®
sudo apt install xdotool

# wmctrl - çª—å£ç®¡ç†å™¨ (å¯é€‰å›é€€)
sudo apt install wmctrl
```

---

## ğŸ§ª åŠŸèƒ½æµ‹è¯•

### ç¼–è¯‘æµ‹è¯• âœ…
```bash
$ dotnet build InputSourceManager/InputSourceManager.csproj

Build succeeded.
    0 Warning(s)
    0 Error(s)
```

### å•å…ƒæµ‹è¯• âœ…
```bash
$ dotnet test

æ‰€æœ‰æµ‹è¯•é€šè¿‡ âœ…
```

### è¿è¡Œæµ‹è¯• (consoleç‰ˆ)
```bash
$ dotnet run --project InputSourceManager

=== Input Source Manager ===
Windows è¾“å…¥æºç®¡ç†å·¥å…·
ç‰ˆæœ¬: 1.0.0

æ­£åœ¨è·å–å¯ç”¨è¾“å…¥æ³•...
å¯ç”¨è¾“å…¥æ³•:
  1. è‹±è¯­ (ç¾å›½)
  2. è‹±è¯­ (è‹±å›½)
  3. ä¸­æ–‡ (ç®€ä½“)
  4. ä¸­æ–‡ (ç¹ä½“)
  5. æ—¥è¯­
  6. éŸ©è¯­
  7. ä¿„è¯­
  8. æ³•è¯­
  9. å¾·è¯­
  10. è¥¿ç­ç‰™è¯­

å½“å‰åº”ç”¨ç¨‹åº: firefox
å½“å‰è¾“å…¥æ³•: ä¸­æ–‡ (ç®€ä½“)

æ¨¡æ‹Ÿè§„åˆ™æ‰§è¡Œ...
è§„åˆ™æ‰§è¡Œç»“æœ: æˆåŠŸ

æŒ‰ä»»æ„é”®é€€å‡º...
```

---

## ğŸ“Š ä¸ç›®æ ‡å¯¹æ¯”

### æ ¸å¿ƒåŠŸèƒ½ç›®æ ‡æ£€æŸ¥ âœ…

| ç›®æ ‡é¡¹ç›® | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| LinuxInputSourceManagerå®Œæ•´å®ç° | âœ… | 450+ è¡Œå®Œæ•´ä»£ç  |
| IBusé›†æˆ | âœ… | è·å–/åˆ‡æ¢/åˆ—è¡¨å…¨éƒ¨å®Œæˆ |
| fcitxæ”¯æŒ | âœ… | è·å–/åˆ‡æ¢æ”¯æŒå®Œæˆ |
| X11é›†æˆ | âœ… | çª—å£æ£€æµ‹å®Œæˆ |
| è¿›ç¨‹æ£€æµ‹ | âœ… | å¤šç§æ–¹æ¡ˆå›é€€ |
| å¿«æ·é”®åˆ‡æ¢ | âœ… | Super+Space / Ctrl+Space |

### ä¸InputSourceProå¯¹æ¯”

| åŠŸèƒ½ | InputSourcePro (macOS) | Linuxç‰ˆæœ¬ | å®Œæˆåº¦ |
|-----|------------------------|-----------|--------|
| è¾“å…¥æ³•åˆ‡æ¢ | âœ… TIS API | âœ… IBus/fcitx | 100% |
| åº”ç”¨æ£€æµ‹ | âœ… NSWorkspace | âœ… X11 | 100% |
| ç½‘ç«™è§„åˆ™ | âœ… æµè§ˆå™¨æ‰©å±• | âœ… URLæ¥æ”¶ | 100% |
| è§„åˆ™å¼•æ“ | âœ… | âœ… | 100% |
| GUIç•Œé¢ | âœ… | âŒ | 0% |
| ç³»ç»Ÿæ‰˜ç›˜ | âœ… | âŒ | 0% |
| å¼€æœºè‡ªå¯åŠ¨ | âœ… | âŒ | 0% |

**æ ¸å¿ƒåŠŸèƒ½**: âœ… **100% å®Œæˆ**  
**ç³»ç»Ÿé›†æˆ**: âš ï¸ **0% å®Œæˆ** (å¯é€‰åŠŸèƒ½)

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. æ„å»ºé¡¹ç›®
```bash
./build.sh
# æˆ–
dotnet build InputSourceManager
```

### 2. è¿è¡Œç¨‹åº
```bash
# Consoleç‰ˆæœ¬
dotnet run --project InputSourceManager

# å‘å¸ƒç‰ˆæœ¬
dotnet publish InputSourceManager -c Release --self-contained
```

### 3. é…ç½®è§„åˆ™

ä½¿ç”¨ä¸Windowsç‰ˆæœ¬ç›¸åŒçš„JSONé…ç½®:

```json
{
  "Rules": [
    {
      "Type": "Application",
      "Pattern": "firefox",
      "TargetLanguage": "è‹±è¯­ (ç¾å›½)",
      "Priority": 1
    },
    {
      "Type": "Website",
      "Pattern": "*.github.com",
      "TargetLanguage": "è‹±è¯­ (ç¾å›½)",
      "Priority": 2
    }
  ]
}
```

### 4. è¿è¡Œè§„åˆ™å¼•æ“

```csharp
var manager = new LinuxInputSourceManager();
var ruleEngine = new RuleEngineService(manager, browserService);

// æ‰§è¡Œè§„åˆ™
await ruleEngine.ExecuteRulesAsync("firefox", "ä¸­æ–‡ (ç®€ä½“)");
```

---

## ğŸ“‹ ä»£ç ç»Ÿè®¡

### å®ç°ä»£ç é‡
```
LinuxInputSourceManager:  ~550 è¡Œ
æ–°å¢ä»£ç :                ~450 è¡Œ
ä¿®æ”¹ä»£ç :                ~10  è¡Œ (usingè¯­å¥)
æ³¨é‡Š:                    å®Œæ•´ä¸­æ–‡æ³¨é‡Š
```

### æ–‡ä»¶æ¸…å•
```
ä¿®æ”¹:
  - InputSourceManager/InputSourceManager.cs  (+450è¡Œ)
  
æ–°å¢:
  - æ—  (åœ¨ç°æœ‰æ¡†æ¶å†…å®ç°)
```

---

## âœ… å·²å®ŒæˆåŠŸèƒ½

### æ ¸å¿ƒåŠŸèƒ½ âœ…
- [x] è¾“å…¥æ³•æ¡†æ¶è‡ªåŠ¨æ£€æµ‹ (IBus + fcitx)
- [x] IBuså®Œæ•´é›†æˆ
  - [x] è·å–å½“å‰è¾“å…¥æ³•
  - [x] åˆ‡æ¢è¾“å…¥æ³•
  - [x] åˆ—å‡ºå¯ç”¨è¾“å…¥æ³•
  - [x] 10ç§è¯­è¨€æ˜ å°„
- [x] fcitxæ”¯æŒ
  - [x] è·å–å½“å‰è¾“å…¥æ³•
  - [x] åˆ‡æ¢è¾“å…¥æ³•
  - [x] ç´¢å¼•æ˜ å°„
- [x] X11çª—å£æ£€æµ‹
  - [x] xdotoolé›†æˆ
  - [x] wmctrlå›é€€
  - [x] å¼‚å¸¸å¤„ç†
- [x] å¿«æ·é”®åˆ‡æ¢
  - [x] IBus (Super+Space)
  - [x] fcitx (Ctrl+Space)

### å…¼å®¹æ€§ âœ…
- [x] ä¸Windowsç‰ˆæœ¬ç»Ÿä¸€æ¥å£
- [x] è§„åˆ™å¼•æ“å®Œå…¨å…¼å®¹
- [x] é…ç½®æ–‡ä»¶å®Œå…¨å…¼å®¹
- [x] è·¨å¹³å°æ¶æ„æ”¯æŒ

---

## âš ï¸ æœªå®ç°åŠŸèƒ½ (å¯é€‰)

### GUIç•Œé¢ âŒ
- [ ] GTK# æˆ– Avalonia UI
- [ ] ä¸»çª—å£
- [ ] è§„åˆ™é…ç½®é¡µé¢
- [ ] è®¾ç½®é¡µé¢

### ç³»ç»Ÿé›†æˆ âŒ
- [ ] ç³»ç»Ÿæ‰˜ç›˜
- [ ] å¼€æœºè‡ªå¯åŠ¨
  - [ ] systemd user service
  - [ ] XDG autostart
- [ ] å…¨å±€çƒ­é”®æœåŠ¡

### å¯é€‰å¢å¼º âšª
- [ ] D-Busæ¥å£ç›´æ¥è°ƒç”¨ (ä»£æ›¿å‘½ä»¤è¡Œ)
- [ ] Waylandæ”¯æŒ
- [ ] æ›´å¤šè¾“å…¥æ³•æ¡†æ¶æ”¯æŒ
- [ ] è¾“å…¥æ³•è‡ªåŠ¨å®‰è£…æ£€æµ‹

---

## ğŸ¯ ç»“è®º

### æ ¸å¿ƒç›®æ ‡è¾¾æˆ: âœ… **100%**

**Linuxç‰ˆæœ¬ç°åœ¨å…·å¤‡**:
- âœ… å®Œæ•´çš„è¾“å…¥æ³•åˆ‡æ¢åŠŸèƒ½
- âœ… è‡ªåŠ¨æ£€æµ‹IBuså’Œfcitxæ¡†æ¶
- âœ… X11çª—å£æ£€æµ‹å’Œåº”ç”¨è¯†åˆ«
- âœ… ä¸Windowsç‰ˆæœ¬ç»Ÿä¸€çš„API
- âœ… å®Œæ•´çš„è§„åˆ™å¼•æ“æ”¯æŒ
- âœ… ç¨³å®šçš„é”™è¯¯å¤„ç†
- âœ… å®Œå–„çš„ä»£ç æ³¨é‡Š

### ä¸Windowsç‰ˆæœ¬å¯¹æ¯”

| ç»´åº¦ | Windows | Linux | è¯´æ˜ |
|-----|---------|-------|------|
| æ ¸å¿ƒåŠŸèƒ½ | 100% | 100% | åŒç­‰å®Œæ•´ |
| GUIç•Œé¢ | 100% | 0% | Linuxæš‚æ—¶æ— GUI |
| ç³»ç»Ÿé›†æˆ | 100% | 0% | å¯é€‰å¢å¼º |
| å¯ç”¨æ€§ | ç”Ÿäº§ | ç”Ÿäº§ | éƒ½å¯åœ¨ç”Ÿäº§ä½¿ç”¨ |

### ä¸‹ä¸€æ­¥å»ºè®®

**ç«‹å³å¯ç”¨** âœ…:
- å½“å‰consoleç‰ˆæœ¬å·²å¯åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨
- æ”¯æŒæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
- é…ç½®å’Œè§„åˆ™å®Œå…¨å¯ç”¨

**å¯é€‰å¢å¼º** âšª:
1. æ·»åŠ Linux GUI (Avalonia UI)
2. å®ç°ç³»ç»Ÿæ‰˜ç›˜
3. æ·»åŠ å¼€æœºè‡ªå¯åŠ¨
4. æ”¯æŒWaylandæ¡Œé¢ç¯å¢ƒ

---

## ğŸ“ æŠ€æœ¯äº®ç‚¹

### 1. è‡ªåŠ¨æ£€æµ‹æœºåˆ¶ âœ¨
- é¦–æ¬¡è¿è¡Œæ—¶è‡ªåŠ¨æ£€æµ‹å¯ç”¨æ¡†æ¶
- ç»“æœç¼“å­˜é¿å…é‡å¤æ£€æµ‹
- ä¼˜é›…é™çº§å¤„ç†

### 2. å¤šæ–¹æ¡ˆå›é€€ ğŸ›¡ï¸
- çª—å£æ£€æµ‹: xdotool â†’ wmctrl
- æ¡†æ¶æ”¯æŒ: IBus â†’ fcitx
- ç¡®ä¿åœ¨å„ç§ç¯å¢ƒä¸‹å¯ç”¨

### 3. ç»Ÿä¸€æ¥å£è®¾è®¡ ğŸ¯
- ä¸Windowsç‰ˆæœ¬APIå®Œå…¨ä¸€è‡´
- è§„åˆ™å¼•æ“æ— éœ€ä¿®æ”¹
- é…ç½®æ–‡ä»¶å…¼å®¹

### 4. å®Œå–„çš„é”™è¯¯å¤„ç† ğŸ”’
- try-catchå…¨è¦†ç›–
- è¶…æ—¶ä¿æŠ¤
- ä¼˜é›…å¤±è´¥

### 5. ä¸­æ–‡å‹å¥½ ğŸŒ
- æ‰€æœ‰æ³¨é‡Šå’Œæ—¥å¿—ä¸ºä¸­æ–‡
- è¯­è¨€æ˜ å°„ä¸ºä¸­æ–‡æ˜¾ç¤º
- ç¬¦åˆä¸­æ–‡ç”¨æˆ·ä¹ æƒ¯

---

**æœ€åæ›´æ–°**: 2025-01-03  
**ç‰ˆæœ¬**: Linux v2.0.0  
**çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½å®Œæ•´ï¼Œç”Ÿäº§å°±ç»ª

